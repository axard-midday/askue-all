

/*
 * ссылка на библиотеку
 */
typedef void* plugin_t;

/*
 * Проверка удалённости сегмента
 */
bool_t __is_remote ( const char *segment )
{
	return segment[ 0 ] == '1';
}

/*
 * Выполнить скрипты
 */
int __askue_exec_script ( void *ptr, int len, char **vals, char **cols )
{
	const char **sptr = ptr;

	#define SCRIPT 		vals[ 0 ]
	#define CNT		sptr[ 0 ]
	#define TYPE		sptr[ 1 ]
	#define TIMEOUT 	sptr[ 2 ]
	
	// получить скрипт
	script_f script = askue_script_access ( TYPE, SCRIPT );
	
	// функция обмена через порт
	auto uint8_array_t* __rs232_port ( const uint8_array_t *request );
	
	parametr
	
	
	
	#undef SCRIPT
	#undef CNT
	#undef TYPE
	#undef TIMEOUT
}

/*
 * Получит все скрипты
 */
#define askue_sql_GET_SCRIPTS "SELECT script_table.script FROM script_table WHERE type = '%s';"
bool_t askue_exec_script ( const char *address, const char *type, const char *timeout )
{
	char *sql = sqlite3_mprintf ( askue_sql_GET_SCRIPTS, type );
	
	if ( sql )
	{
		const char *params[] =
		{
			address, type, timeout
		};
	
		verdict = sqlite3_exec_decor ( askue_db_access (), askue_sql_GET_SCRIPTS, __exec_script, params );
		sqlite3_free ( sql );
		return verdict;
	}
	else
	{
		perror ( "askue: askue_monitor_exec_script(): sqlite3_mprintf()" );
		abort ();
	}
}


#define askue_sql_GET_COUNTERS "SELECT cnt_tbl.cnt, cnt_tbl.type, cnt_tbl.timeout, cnt_tbl.modem, modem_tbl.remote_flag, modem_tbl.type FROM cnt_tbl, modem_tbl WHERE cnt_tbl.modem = modem_tbl.modem;"
bool_t askue_monitor ( void )
{		
	int __callback ( void *ptr, int len, char **vals, char **cols )
	{
		#define CNT 		vals[ 0 ]
		#define CNT_TYPE 	vals[ 1 ]
		#define CNT_TIMEOUT	vals[ 2 ]
		#define MODEM 		vals[ 3 ]
		#define REMOTE_FLAG 	vals[ 4 ]
		#define MODEM_TYPE 	vals[ 5 ]

		/*
		if ( __is_remote ( REMOTE_FLAG ) )
		{
			return !( askue_exec_script ( MODEM, MODEM_TYPE, "3000" ) && 
				   askue_exec_script ( CNT, CNT_TYPE, CNT_TIMEOUT ) );
		}
		else
		{
			return !askue_exec_script ( CNT, CNT_TYPE, CNT_TIMEOUT );
		}
		*/
		
		printf ( ">> | %s | %s | %s | %s | %s | %s | remote = %d\n", CNT,
									     CNT_TYPE,
									     CNT_TIMEOUT,
									     MODEM,
									     REMOTE_FLAG,
									     MODEM_TYPE,
									     __is_remote ( REMOTE_FLAG ) );
		
	
		#undef CNT
		#undef CNT_TYPE
		#undef CNT_TIMEOUT
		#undef MODEM
		#undef REMOTE_FLAG
		#undef MODEM_TYPE
	}
     
	return sqlite3_exec_decor ( askue_db_access (), askue_sql_GET_COUNTERS, askue_extract_devices, NULL );
}
#undef askue_sql_GET_COUNTERS







































